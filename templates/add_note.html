<!DOCTYPE html>
<html lang="en">
  <head>
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"  crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" crossorigin="anonymous"></script>
    <script src="{{url_for('static',filename='atrament.min.js') }}" crossorigin="anonymous"></script>
    <link  rel="stylesheet"  href="{{url_for('static',filename='add_note.css') }}">
     <link  rel="stylesheet"  href="{{url_for('static',filename='universal.css') }}"> 

  </head>
  <body>
  <h1 class="raleway" align="center"> Add Note</h1>
  <br><br>

  Title
  <input type="text" id="title" class="form-control">
  Draw Here
  <div id="border">
  <canvas id="drawing_pad">
  </div>

  <div align="center">
   <h3 class="error_text" id="error"></h3>
    <button class="btn btn-md custom_button_black" id="clear">Clear</button>
    <button class="btn btn-md custom_button_black" id="eraser">Eraser</button>
    <button class="btn btn-md custom_button_black" id="draw">Draw</button>

    <br><br>
     <button class="btn btn-md custom_button_black"  id="submit">Submit</button>
  
  <br><br><br>
   <div id="callback"></div>
     </div>

<script src="//cdn.jsdelivr.net/pouchdb/6.2.0/pouchdb.min.js"></script>

  <script>


var pad = atrament('#drawing_pad', screen.width-1, screen.height/2, 'black');
  
    $("#clear").on('click',function(){
    if (confirm("Are you sure you want to clear drawing pad?") == true){
        pad.clear();    
    }
    else{
      x = 'asd'
    }
  });

  $("#eraser").on('click', function(){
    pad.color = '#fff'
    pad.weight = 20
  })
  $("#draw").on('click', function(){
    pad.color = 'black';
    pad.weight = 3
  })

    $("#submit").on('click', function(){

      var img = pad.toImage();
      if ($("#title").val() == 0){
        $("#error").text('Title is empty');
      } 

      else if ($("#date").val() == 0){
        $("#error").text('Due date is empty');
      } 

      else{


  $.ajax({
  type: "POST",
  contentType: "application/json; charset=utf-8",
  url: "/add_note",
  dataType: "json",
  data: JSON.stringify
  ({
    'img': img,
    'title':$("#title").val(),
    'due_date' : $("#date").val()
  }),
  success: function (data) {
    if (data.response == 'success'){
      $("#callback").html('<h3 style="color: green;" class="raleway" id="success">Note Created! Click the button below to view it</h3>'+'<a href="/note/'+data.url+'"><button class="btn btn-md custom_button_black">View Note</button></a>')
    }


    }

  })
}
  
    })
    /*
    // check if Service Worker support exists in browser or not
if( 'serviceWorker' in navigator ) {
    navigator.serviceWorker  
                       .register( "{{url_for('static',filename='service-worker.js') }}")  
                       .then( function( ) { 
                           console.log('Congratulations!!Service Worker Registered');

                       })
                       .catch( function( err) {
                           console.log(`Aagh! Some kind of Error :- ${err}`);
                       });

} else {
    console.log("serviceWorker doesn't work")
}
*/
   
  </script>

  
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
  </body>
</html>